"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.moduleSource = void 0;
exports.hotReloadExportedItem = hotReloadExportedItem;
exports.moduleSource = new WeakMap();
function hotReloadExportedItem(exportedItem, handleExportedItem) {
    const source = exports.moduleSource.get(exportedItem);
    if (!source) {
        const v = handleExportedItem(exportedItem);
        return { dispose: () => { v?.dispose(); } };
    }
    let curDisposable = handleExportedItem(exportedItem);
    const updateStrategy = source.module.registerUpdateStrategy({
        applyUpdate: _changeInfo => {
            source.module.reload();
            const newValue = source.module.exports[source.exportName];
            curDisposable?.dispose();
            curDisposable = handleExportedItem(newValue);
            return true;
        }
    });
    return {
        dispose: () => {
            curDisposable?.dispose();
            updateStrategy.dispose();
        }
    };
}
//# sourceMappingURL=hotReloadExportedItem.js.map