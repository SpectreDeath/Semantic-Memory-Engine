import { HotReloadOptions } from "./node";
import { IDisposable } from "./disposable";
import { Logger } from "./logging";
import { NodeJsModule } from "./nodeApi";
export declare class HotReloadService {
    private readonly _logger;
    private readonly _shouldIgnoreModule;
    private readonly _shouldIgnoreRequireRequest;
    private static _instance;
    static get instance(): HotReloadService | undefined;
    static initialize(options: HotReloadOptions): void;
    readonly interceptor: {
        originalRequire: (module: NodeJsModule, request: string) => unknown;
        originalLoad: (module: NodeJsModule, filename: string) => unknown;
    } & IDisposable;
    private readonly _trackedModules;
    private readonly _watcher;
    private readonly _onTrackedModuleExportsLoaded;
    readonly onTrackedModuleExportsLoaded: import("./utils").Event<{
        module: TrackedModule;
    }>;
    constructor(_logger: Logger, _shouldIgnoreModule: (moduleFilename: string) => boolean, _shouldIgnoreRequireRequest: (request: string) => boolean);
    trackModule(module: NodeModule): void;
    private _getOrCreateTrackedModule;
    private _onBeforeRequire;
    private _onAfterLoad;
    private _handleFileChanges;
    markChanged(moduleOrFilename: NodeModule | string): void;
}
export declare class TrackedModule {
    readonly filename: string;
    private readonly _hotReloadService;
    private readonly _logger;
    private readonly _watch;
    readonly consumers: Set<TrackedModule>;
    exports: Record<string, unknown>;
    private readonly _updateStrategies;
    readonly updateStrategies: ReadonlySet<IUpdateStrategy>;
    registerUpdateStrategy(strategy: IUpdateStrategy): IDisposable;
    private _updateCounter;
    private _updatedCosumers;
    private _active;
    get active(): boolean;
    private _moduleChanged;
    private readonly _changedDependencies;
    private _watcher;
    constructor(filename: string, _hotReloadService: HotReloadService, _logger: Logger, _watch: () => IDisposable);
    watch(): void;
    beginUpdate(stack: TrackedModule[]): void;
    endUpdate(): void;
    markChanged(): void;
    markDependencyChanged(changeInfo: ModuleChangeInfo): void;
    private _checkUpdateInProgress;
    clearCache(): void;
    reload(): void;
    toString(): string;
}
export interface IUpdateStrategy {
    applyUpdate(changeInfo: ModuleChangeInfo): boolean;
}
export declare class ModuleChangeInfo {
    readonly module: TrackedModule;
    /**
     * Is set, if the current module changed.
     */
    readonly moduleChanged: boolean;
    /**
     * Describes the changes of the dependent modules.
     */
    readonly dependencyChangeInfos: ReadonlySet<ModuleChangeInfo>;
    constructor(module: TrackedModule, 
    /**
     * Is set, if the current module changed.
     */
    moduleChanged: boolean, 
    /**
     * Describes the changes of the dependent modules.
     */
    dependencyChangeInfos: ReadonlySet<ModuleChangeInfo>);
    toString(): string;
    private _toJson;
}
//# sourceMappingURL=HotReloadService.d.ts.map